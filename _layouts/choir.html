---
layout: default
---

<article class="choir">

  <h2>{{ page.name }}</h2>

  <p><strong>City:</strong> {{ page.city }}</p>

  {% if page.founded %}
    <p><strong>Founded:</strong> {{ page.founded }}</p>
  {% endif %}

  {% if page.voice_types %}
    <p>
      <strong>Voices:</strong>
      {{ page.voice_types | join: ", " }}
    </p>
  {% endif %}

  {% if page.website %}
    <p>
      <a href="{{ page.website }}" target="_blank">Website</a>
    </p>
  {% endif %}

  {% if page.conductors %}
    <h3>Current Conductors</h3>
    <ul class="choir-conductors">
      {% for c in page.conductors %}
        {% if c.slug %}
          {% assign conductor = site.people | where: "slug", c.slug | first %}
          {% if conductor %}
            <li>
              <a href="{{ conductor.url | relative_url }}">
                {{ conductor.name }}
              </a>
            </li>
          {% else %}
            <li>{{ c.slug }}</li>
          {% endif %}
        {% elsif c.name %}
          <li{% if c.external %} class="external"{% endif %}>
            {{ c.name }}
          </li>
        {% else %}
          <li>{{ c }}</li>
        {% endif %}
      {% endfor %}
    </ul>
  {% endif %}

  <div class="description">
    {{ content }}
  </div>

  {% comment %}
  -----------------------------
  EVENTS SECTION
  -----------------------------
  {% endcomment %}

  {% assign now = "now" | date: "%s" %}

  {% comment %}
  Filter events where this choir participates.
  We must extract the slugs because `event.choirs` is an array of objects.
  {% endcomment %}
  {% assign choir_events = site.events | where_exp: "event", "event.choirs | map: 'slug' | contains page.slug" %}

  {% comment %}
  Sort first by start date (ascending) to avoid Liquid filtering issues.
  Use event.start | date: '%s' to compare Unix timestamps reliably.
  {% endcomment %}
  {% assign upcoming_events = choir_events | sort: "start" %}
  {% assign upcoming_events = upcoming_events | where_exp: "event", "event.start and event.start | date: '%s' >= now" %}

  {% assign past_events = choir_events | sort: "start" | reverse %}
  {% assign past_events = past_events | where_exp: "event", "event.start and event.start | date: '%s' < now" %}

  <h3>Upcoming Events</h3>
  {% if upcoming_events.size > 0 %}
    <ul>
      {% for event in upcoming_events %}
        <li>
          <a href="{{ event.url | relative_url }}">
            {{ event.title }}
          </a>
          {% if event.start %}
            – {{ event.start | date: "%d %B %Y" }}
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p>This choir has no upcoming events.</p>
  {% endif %}

  <h3>Past Events</h3>
  {% if past_events.size > 0 %}
    <ul>
      {% for event in past_events %}
        <li>
          <a href="{{ event.url | relative_url }}">
            {{ event.title }}
          </a>
          {% if event.start %}
            – {{ event.start | date: "%d %B %Y" }}
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p>This choir has no past events.</p>
  {% endif %}

</article>
