---
layout: default
---

<article class="choir">

  <h2>{{ page.name }}</h2>

  <p><strong>City:</strong> {{ page.city }}</p>

  {% if page.founded %}
    <p><strong>Founded:</strong> {{ page.founded }}</p>
  {% endif %}

  {% if page.voice_types %}
    <p>
      <strong>Voices:</strong>
      {{ page.voice_types | join: ", " }}
    </p>
  {% endif %}

  {% if page.website %}
    <p>
      <a href="{{ page.website }}" target="_blank">Website</a>
    </p>
  {% endif %}

  <div class="description">
    {{ content }}
  </div>

  {% if page.conductors %}
    <h3>Current Conductors</h3>
    <ul class="choir-conductors">
      {% for c in page.conductors %}
        {% if c.slug %}
          {% assign conductor = site.people | where: "slug", c.slug | first %}
          {% if conductor %}
            <li>
              <a href="{{ conductor.url | relative_url }}">
                {{ conductor.name }}
              </a>
            </li>
          {% else %}
            <li>{{ c.slug }}</li>
          {% endif %}
        {% elsif c.name %}
          <li{% if c.external %} class="external"{% endif %}>
            {{ c.name }}
          </li>
        {% else %}
          <li>{{ c }}</li>
        {% endif %}
      {% endfor %}
    </ul>
  {% endif %}

  {% if page.past_conductors %}
    <h3>Past Conductors</h3>
    <ul class="choir-conductors past">
      {% for c in page.past_conductors %}
        {% if c.slug %}
          {% assign conductor = site.people | where: "slug", c.slug | first %}
          {% if conductor %}
            <li>
              <a href="{{ conductor.url | relative_url }}">
                {{ conductor.name }}
              </a>
            </li>
          {% else %}
            <li>{{ c.slug }}</li>
          {% endif %}
        {% elsif c.name %}
          <li{% if c.external %} class="external"{% endif %}>
            {{ c.name }}
          </li>
        {% else %}
          <li>{{ c }}</li>
        {% endif %}
      {% endfor %}
    </ul>
  {% endif %}

  {% comment %}
  -----------------------------
  EVENTS SECTION
  Works with Jekyll 3.10.0 / GitHub Pages
  -----------------------------
  {% endcomment %}

  {% assign now = "now" | date: "%s" %}

  {% comment %}
  Collect choir events manually because we cannot use pipes inside where_exp
  {% endcomment %}
  {% assign choir_events = "" | split: "," %}

  {% for event in site.events %}
    {% assign choir_slugs = event.choirs | map: "slug" %}
    {% if choir_slugs contains page.slug %}
      {% assign choir_events = choir_events | push: event %}
    {% endif %}
  {% endfor %}

  {% assign upcoming_events = "" | split: "," %}
  {% assign past_events = "" | split: "," %}

  {% for event in choir_events %}
    {% if event.start %}
      {% assign event_ts = event.start | date: "%s" %}
      {% if event_ts >= now %}
        {% assign upcoming_events = upcoming_events | push: event %}
      {% else %}
        {% assign past_events = past_events | push: event %}
      {% endif %}
    {% endif %}
  {% endfor %}

  {% assign upcoming_events = upcoming_events | sort: "start" %}
  {% assign past_events = past_events | sort: "start" | reverse %}

  <h3>Upcoming Events</h3>
  {% if upcoming_events.size > 0 %}
    <ul>
      {% for event in upcoming_events %}
        <li>
          <a href="{{ event.url | relative_url }}">
            {{ event.title }}
          </a>
          {% if event.start %}
            – {{ event.start | date: "%d %B %Y" }}
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p>This choir has no upcoming events.</p>
  {% endif %}

  <h3>Past Events</h3>
  {% if past_events.size > 0 %}
    <ul>
      {% for event in past_events %}
        <li>
          <a href="{{ event.url | relative_url }}">
            {{ event.title }}
          </a>
          {% if event.start %}
            – {{ event.start | date: "%d %B %Y" }}
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p>This choir has no past events.</p>
  {% endif %}

</article>
